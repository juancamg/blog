---
title: 'AoC 2024: DÃ­a 3 - AnÃ¡lisis de Logs ğŸ”'
description: 'Resolvemos el reto del dÃ­a 3 en el Advent of Cyber 2024 organizado por TryHackMe.'
image: '/images/blog/advent-of-cyber-2024/thumbnails/day3.png'
date: '2024-12-03'
author: 'xhetic'
tag: ['TryHackMe', 'Principiante', 'Logs', 'ELK', 'Advent of Cyber']
category: 'Writeups'
featured: false
---

## ğŸŒŸ IntroducciÃ³n

En el reto del **DÃ­a 3**, exploraremos el anÃ¡lisis de logs con ELK y recrearemos un ataque para identificar vulnerabilidades en una aplicaciÃ³n web.

Room: [Advent of Cyber 2024](https://tryhackme.com/r/room/adventofcyber2024)

---

### ğŸ¯ Objetivos de aprendizaje

1. Comprender cÃ³mo analizar logs usando Kibana (parte del stack ELK).
2. Aprender a investigar vulnerabilidades de ejecuciÃ³n remota de cÃ³digo (RCE) mediante subida de archivos.
3. Reforzar habilidades prÃ¡cticas en ciberseguridad.

---

## ğŸ› ï¸ Parte 1: TeorÃ­a y fundamentos

Antes de comenzar con la prÃ¡ctica, repasemos algunos conceptos clave que nos ayudarÃ¡n a comprender mejor lo que haremos.

### ğŸ” Â¿QuÃ© es ELK?

ELK es un conjunto de herramientas que facilita la recopilaciÃ³n, anÃ¡lisis y visualizaciÃ³n de logs:

- **Elasticsearch:** Almacena y busca grandes volÃºmenes de datos de manera eficiente.
- **Logstash:** Procesa y transporta los logs a Elasticsearch.
- **Kibana:** Proporciona una interfaz grÃ¡fica para explorar y analizar los datos.

En este reto, usaremos **Kibana** para investigar un ataque mediante logs.

### ğŸ“„ Vulnerabilidades de subida de archivos

La funcionalidad de subir archivos en sitios web puede ser peligrosa si no se implementa correctamente. Algunos riesgos incluyen:

- **EjecuciÃ³n remota de cÃ³digo (RCE):** Subir scripts maliciosos que el servidor ejecuta.
- **Robo de datos:** Subir archivos diseÃ±ados para acceder a informaciÃ³n sensible.

El ataque que recrearemos aprovecha una vulnerabilidad en la validaciÃ³n de archivos subidos.

---

## ğŸ•µï¸â€â™‚ï¸ Parte 2: InvestigaciÃ³n del ataque (OperaciÃ³n Blue)

### Iniciando la investigaciÃ³n

Inicio la mÃ¡quina virtual desde la tarea de TryHackMe y configuro el archivo `hosts` con el siguiente comando para redirigir el dominio local:

```bash
echo "<IP_DE_LA_MÃQUINA> frostypines.thm" >> /etc/hosts
```

Con esto listo, accedo a Kibana en la URL `http://<IP_DE_LA_MÃQUINA>:5601`.

### Explorando los logs

En Kibana, voy a la secciÃ³n **Discover** y selecciono la colecciÃ³n `frostypines-resorts`. Ajusto el filtro de tiempo para revisar los logs entre **11:30 y 12:00 del 3 de octubre de 2024**.

Ahora, Â¿quÃ© busco? La tarea menciona un archivo sospechoso llamado `shell.php`. Uso la barra de bÃºsqueda para localizarlo:

```kql
message: "shell.php"
```

Â¡Bingo! Encuentro la ruta donde se subiÃ³ la web shell: `/media/images/rooms/shell.php`. TambiÃ©n descubro que la IP atacante es `10.11.83.34`. Con esta informaciÃ³n, ya tengo una idea clara de cÃ³mo se llevÃ³ a cabo el ataque.

## ![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img1.png)

## ğŸš© Parte 3: RecreaciÃ³n del ataque (OperaciÃ³n Red)

### Explorando el sitio web

Accedo a la pÃ¡gina principal `http://frostypines.thm` y hago un anÃ¡lisis general para entender cÃ³mo estÃ¡ construida. Â¿QuÃ© descubro? Probando un poco, encuentro esta ruta interesante: `http://frostypines.thm/admin/users.php`. Â¡Vaya! AquÃ­ estÃ¡n los usuarios registrados de la base de datos.

![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img2.png)

### Probando credenciales

Â¿Y si intento con contraseÃ±as por defecto? Pruebo combinaciones tÃ­picas como `admin`, `root`, `1234`... Â¡Y voilÃ ! La contraseÃ±a `admin` funciona. Ahora estoy dentro como administrador ğŸ‰. Parece que la seguridad no es su fuerte...

### Subiendo la web shell

Desde el panel de administrador, veo que puedo aÃ±adir nuevas habitaciones al hotel. En el formulario, hay un campo para subir imÃ¡genes. AquÃ­ aprovecho para subir un archivo malicioso llamado `shell.php` en lugar de una imagen legÃ­tima. Guardo los cambios y el archivo queda alojado en el servidor.

![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img3.png)

### Accediendo a la shell

Con el archivo subido, voy a la lista de habitaciones en la pestaÃ±a `rooms`. Analizo la ruta de las imÃ¡genes y veo algo como esto:

```html
src="http://frostypines.thm/media/images/rooms/1.jpg"
```

![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img4.png)

Sustituyo `1.jpg` por `shell.php` en la URL:

```
http://frostypines.thm/media/images/rooms/shell.php
```

Â¡Funciona! Ahora tengo acceso a la shell. Pruebo algunos comandos como `whoami` para confirmar que tengo control.

![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img5.png)

### Encontrando la bandera

Exploro el sistema con el comando `ls` y encuentro un archivo llamado `flag.txt`. Lo leo con:

```bash
cat flag.txt
```

![Captura de pantalla](/images/blog/advent-of-cyber-2024/day3-img6.png)

ğŸ‰ **Resultado:** La bandera es `THM{Gl1tch_Was_H3r3}`.

---

## ğŸ¯ ConclusiÃ³n

Hoy he aprendido a investigar un ataque utilizando herramientas de anÃ¡lisis de logs y he recreado un escenario prÃ¡ctico para entender cÃ³mo las vulnerabilidades en la subida de archivos pueden ser explotadas. Este conocimiento es esencial para proteger aplicaciones web y responder a incidentes de manera efectiva.

ğŸŒŸ Â¡Sigue participando en los retos del Calendario de Adviento de Ciberseguridad 2024 para fortalecer tus habilidades! ğŸ’ª

Â¿Tienes alguna duda o sugerencia? Â¡DÃ©jame un comentario! ğŸ˜Š
